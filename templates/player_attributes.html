{% extends "base.html" %}
{% block content %}

<div class="attr-page">

    <div class="attr-header">
        <h1>Spieler-Attribute<br>
            <span>{{ player.full_name }}</span>
        </h1>
    </div>

    <!-- GLOBAL VALUE DISPLAY -->
    <div class="current-attr-box">
        <div class="current-attr-label" id="current-attr-label">Attribut</div>
        <div class="current-attr-value" id="current-attr-value">–</div>
    </div>

    <style>

        /* =============== GLOBAL VALUE BOX STYLE =============== */

        .current-attr-box {
            width: 100%;
            max-width: 360px;
            margin: 10px auto 0 auto;
            padding: 10px 14px;
            border-radius: 12px;
            background-color: #172338;
            color: #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
            border: 1px solid rgba(60,255,154,0.25);
        }

        .current-attr-label {
            opacity: 0.75;
            font-size: 12px;
        }

        .current-attr-value {
            font-size: 20px;
            font-weight: 700;
            color: #3cff9a;
        }


        /* ================= YOUR ORIGINAL STYLES ================= */

        .attr-page {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .attr-header {
            padding: 8px 4px 0 4px;
            text-align: left;
        }

        .attr-header h1 {
            margin: 0;
            font-size: 22px;
            line-height: 1.3;
        }

        .attr-header span {
            font-size: 14px;
            font-weight: 400;
        }

        .attr-wrapper {
            flex: 1;
            overflow-y: auto;
            padding: 6px 10px 4px 10px;
            margin-top: 6px;
        }

        .attr-section {
            background: rgba(8, 18, 40, 0.95);
            border-radius: 14px;
            padding: 8px 10px 6px 10px;
            margin-bottom: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            border: 1px solid rgba(60, 255, 154, 0.25);
        }

        .attr-section-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            opacity: 0.9;
        }

        .attr-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }

        .attr-row {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .attr-label {
            font-size: 11px;
            opacity: 0.9;
        }

        .attr-input {
            width: 100%;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(3, 10, 28, 0.9);
            color: #f8f9ff;
            font-size: 12px;
            padding: 4px 6px;
            outline: none;
        }

        .attr-input:focus {
            border-color: #3cff9a;
            box-shadow: 0 0 0 1px rgba(60,255,154,0.5);
        }

        .attr-range {
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: linear-gradient(
                to right,
                rgba(60,255,154,0.9),
                rgba(60,255,154,0.2)
            );
            border-radius: 999px;
        }

        .attr-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #f0faff;
            border: 2px solid #3cff9a;
            box-shadow: 0 0 6px rgba(0,0,0,0.6);
            margin-top: -6px;
        }

        .attr-scale {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            opacity: 0.65;
            margin-top: 1px;
        }

        .formation-box {
            margin-top: 6px;
            background: rgba(8, 18, 40, 0.95);
            border-radius: 14px;
            padding: 8px 10px;
            border: 1px solid rgba(60, 255, 154, 0.25);
            font-size: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        .formation-select {
            width: 100%;
            margin-top: 4px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(3, 10, 28, 0.9);
            color: #f8f9ff;
            font-size: 12px;
            padding: 4px 6px;
        }

        .step-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: rgba(255,255,255,0.25);
        }

        .step-dot-active {
            background: #3cff9a;
            width: 18px;
        }

        .attr-step {
            display: none;
        }

        .attr-step-active {
            display: block;
        }

    </style>

    <div class="attr-wrapper">

        <form method="post" style="font-size: 13px;">

            <div class="step-dots">
                <div id="step-dot-1" class="step-dot step-dot-active"></div>
                <div id="step-dot-2" class="step-dot"></div>
            </div>

            <!-- =============== STEP 1 =============== -->
            <div id="attr-step-1" class="attr-step attr-step-active">

                <div class="attr-section">
                    <div class="attr-section-title">Physisch</div>
                    <div class="attr-grid">

                        <!-- SPEED -->
                        <div class="attr-row">
                            <span class="attr-label">Speed (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="speed" min="1" max="10"
                                   value="{{ player.speed }}" data-label="Speed">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- STAMINA -->
                        <div class="attr-row">
                            <span class="attr-label">Stamina / Ausdauer (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="stamina" min="1" max="10"
                                   value="{{ player.stamina }}" data-label="Ausdauer">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- STRENGTH -->
                        <div class="attr-row">
                            <span class="attr-label">Strength / Körper (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="strength" min="1" max="10"
                                   value="{{ player.strength }}" data-label="Körperstärke">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- AGGRESSION -->
                        <div class="attr-row">
                            <span class="attr-label">Aggressivität (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="aggression" min="1" max="10"
                                   value="{{ player.aggression }}" data-label="Aggressivität">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- TACKLING -->
                        <div class="attr-row">
                            <span class="attr-label">Tackling / Verteidigung (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="tackling" min="1" max="10"
                                   value="{{ player.tackling }}" data-label="Tackling">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- HEIGHT -->
                        <div class="attr-row">
                            <span class="attr-label">Größe (cm)</span>
                            <input class="attr-input" type="number" name="height_cm" min="120" max="220"
                                   value="{{ player.height_cm or '' }}">
                        </div>

                        <!-- WEIGHT -->
                        <div class="attr-row">
                            <span class="attr-label">Gewicht (kg)</span>
                            <input class="attr-input" type="number" name="weight_kg" min="30" max="120"
                                   value="{{ player.weight_kg or '' }}">
                        </div>

                        <!-- FOOT -->
                        <div class="attr-row">
                            <span class="attr-label">Starker Fuß</span>
                            <input class="attr-input attr-range" type="range"
                                   name="preferred_foot_slider"
                                   id="preferred_foot_slider"
                                   min="0" max="1" step="1"
                                   value="{% if player.preferred_foot == 'Right' %}1{% else %}0{% endif %}">
                            <div class="attr-scale">
                                <span>Links</span>
                                <span id="foot_label" style="font-weight: 600;">
                                    {% if player.preferred_foot == 'Right' %}Rechts{% else %}Links{% endif %}
                                </span>
                                <span>Rechts</span>
                            </div>
                        </div>

                    </div>
                </div>

                <div style="text-align: center; margin: 8px 0 4px;">
                    <button class="btn" type="button" id="btn-next-step">
                        Weiter zu Technik
                    </button>
                </div>
            </div>

            <!-- =============== STEP 2 =============== -->
            <div id="attr-step-2" class="attr-step">

                <div class="attr-section">
                    <div class="attr-section-title">Technik &amp; Spielverständnis</div>
                    <div class="attr-grid">

                        <!-- FIRST TOUCH -->
                        <div class="attr-row">
                            <span class="attr-label">Ballkontrolle / First Touch (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="first_touch" min="1" max="10"
                                   value="{{ player.first_touch }}" data-label="Ballkontrolle">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- DRIBBLING -->
                        <div class="attr-row">
                            <span class="attr-label">Dribbling (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="dribbling" min="1" max="10"
                                   value="{{ player.dribbling }}" data-label="Dribbling">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- SHORT PASSING -->
                        <div class="attr-row">
                            <span class="attr-label">Short Passing (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="short_passing" min="1" max="10"
                                   value="{{ player.short_passing }}" data-label="Kurzpassspiel">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- LONG PASSING -->
                        <div class="attr-row">
                            <span class="attr-label">Long Passing (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="long_passing" min="1" max="10"
                                   value="{{ player.long_passing }}" data-label="Langpassspiel">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- FINISHING -->
                        <div class="attr-row">
                            <span class="attr-label">Finishing / Abschluss (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="finishing" min="1" max="10"
                                   value="{{ player.finishing }}" data-label="Abschluss">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- SHOT POWER -->
                        <div class="attr-row">
                            <span class="attr-label">Shot Power / Schusskraft (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="shooting_power" min="1" max="10"
                                   value="{{ player.shooting_power }}" data-label="Schusskraft">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                        <!-- DECISION MAKING -->
                        <div class="attr-row">
                            <span class="attr-label">Decision Making / Spielintelligenz (1–10)</span>
                            <input class="attr-input attr-range" type="range" name="decision_making" min="1" max="10"
                                   value="{{ player.decision_making }}" data-label="Spielintelligenz">
                            <div class="attr-scale"><span>1</span><span>10</span></div>
                        </div>

                    </div>
                </div>

                <div class="formation-box">
                    <div style="font-weight: 600; font-size: 11px; text-transform: uppercase;">
                        Formation
                    </div>
                    <div style="margin-top: 4px; font-size: 11px; opacity: 0.85;">
                        Wähle die Formation, in der du den Spieler einsetzen möchtest.
                    </div>
                    <select class="formation-select" name="formation">
                        <option value="4-3-3">4-3-3</option>
                        <option value="4-2-3-1">4-2-3-1</option>
                        <option value="4-4-2">4-4-2</option>
                        <option value="4-4-2-diamond">4-4-2 Raute</option>
                        <option value="4-1-4-1">4-1-4-1</option>
                        <option value="4-3-1-2">4-3-1-2</option>
                        <option value="3-5-2">3-5-2</option>
                        <option value="3-4-3">3-4-3</option>
                    </select>
                </div>

                <div style="text-align: center; margin: 10px 0 6px;">
                    <button class="btn" type="submit" name="action" value="suggest">
                        Spielerposition vorschlagen
                    </button>
                </div>

            </div>

        </form>
    </div>

    <div style="text-align: center; margin-top: 4px;">
        <a href="{{ url_for('list_players') }}">
            <button class="btn" type="button">Zurück zur Übersicht</button>
        </a>
    </div>

    <div style="text-align: center; margin-top: 4px; margin-bottom: 4px;">
        <a href="{{ url_for('start') }}">
            <button class="btn" type="button">Zur Startseite</button>
        </a>
    </div>

</div>

<!-- ================= LIVE SLIDER DISPLAY SCRIPT ================= -->
<script>
document.addEventListener('DOMContentLoaded', function () {

    /* ---------- STEP SWITCHING ----------- */

    const step1 = document.getElementById('attr-step-1');
    const step2 = document.getElementById('attr-step-2');
    const dot1 = document.getElementById('step-dot-1');
    const dot2 = document.getElementById('step-dot-2');
    const btnNext = document.getElementById('btn-next-step');

    function showStep(step) {
        if (step === 1) {
            step1.classList.add('attr-step-active');
            step2.classList.remove('attr-step-active');
            dot1.classList.add('step-dot-active');
            dot2.classList.remove('step-dot-active');
        } else {
            step1.classList.remove('attr-step-active');
            step2.classList.add('attr-step-active');
            dot1.classList.remove('step-dot-active');
            dot2.classList.add('step-dot-active');
        }
    }

    if (btnNext) btnNext.addEventListener('click', () => showStep(2));

    /* ---------- PREFERRED FOOT LIVE UPDATE ----------- */

    const footSlider = document.getElementById('preferred_foot_slider');
    const footLabel = document.getElementById('foot_label');

    if (footSlider && footLabel) {
        footSlider.addEventListener('input', () => {
            footLabel.textContent = (footSlider.value === '0') ? 'Links' : 'Rechts';
        });
    }

    /* ---------- GLOBAL LIVE VALUE DISPLAY ----------- */

    const displayLabel = document.getElementById('current-attr-label');
    const displayValue = document.getElementById('current-attr-value');
    const sliders = document.querySelectorAll('.attr-range');

    function updateDisplay(slider) {
        const label = slider.dataset.label || slider.name || "Attribut";
        displayLabel.textContent = label;
        displayValue.textContent = slider.value;
    }

    sliders.forEach(slider => {
        slider.addEventListener('input', () => updateDisplay(slider));
        slider.addEventListener('focus', () => updateDisplay(slider));
    });

    // Initialize with the first slider
    if (sliders.length > 0) {
        updateDisplay(sliders[0]);
    }

});
</script>

{% endblock %}
