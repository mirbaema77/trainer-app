{% extends "base.html" %}
{% block content %}

<div class="attr-page">

    <div class="attr-header">
        <h1>
            <span id="attr-main-title">Physische Attribute</span><br>
            <span class="player-name">{{ player.full_name }}</span>
        </h1>
    </div>

<style>
/* ===== PAGE STRUCTURE ===== */
.attr-page {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.attr-header {
    padding: 8px 4px 0 4px;
    text-align: left;
}

.attr-header h1 {
    margin: 0;
    font-size: 22px;
    line-height: 1.3;
}

.attr-header .player-name {
    font-size: 14px;
    font-weight: 400;
}

.attr-wrapper {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 6px 10px 4px 10px;
    margin-top: 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* ===== ATTRIBUTE BOX ===== */
.attr-section {
    background: rgba(8, 18, 40, 0.95);
    border-radius: 14px;
    padding: 8px 10px 6px 10px;
    margin-bottom: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    border: 1px solid rgba(60, 255, 154, 0.25);
}

.attr-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 6px;
}

.attr-row {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.attr-label {
    font-size: 11px;
    opacity: 0.9;
}

.attr-input {
    width: 100%;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(3, 10, 28, 0.9);
    color: #f8f9ff;
    font-size: 12px;
    padding: 4px 6px;
    outline: none;
    box-sizing: border-box;
}

/* wrapper around each slider for proper positioning */
.slider-wrapper {
    position: relative;
    margin-top: 8px;
}

/* ===== SLIDERS ===== */
.attr-range,
.attr-range-foot {
    -webkit-appearance: none;
    appearance: none;
    height: 4px;
    background: linear-gradient(
        to right,
        rgba(60,255,154,0.2),
        rgba(60,255,154,0.9)
    );
    border-radius: 999px;
    width: 100%;
    margin: 0;
}

/* hide native thumb – our bubble is the visual handle */
.attr-range::-webkit-slider-thumb,
.attr-range-foot::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 0;
    height: 0;
    border: none;
}
.attr-range::-moz-range-thumb,
.attr-range-foot::-moz-range-thumb {
    width: 0;
    height: 0;
    border: none;
}

/* 1–10 labels below slider */
.attr-scale {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    opacity: 0.65;
    margin-top: 2px;
}

/* small number bubble */
.attr-range-value {
    position: absolute;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: #ffffff;
    border: 2px solid #3cff9a;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: #000;
    box-shadow: 0 0 4px rgba(0,0,0,0.35);
    pointer-events: none;
    top: 50%;                 /* vertically centered on the track */
    transform: translate(-50%, -50%);
}

/* ===== STEP DOTS ===== */
.step-dots {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin: 8px 0;
}

.step-dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: rgba(255,255,255,0.25);
}

.step-dot-active {
    background: #3cff9a;
    width: 18px;
}

.attr-step {
    display: none;
}

.attr-step-active {
    display: block;
}
</style>

<div class="attr-wrapper">

    <form method="post" style="font-size: 13px;">

        <div class="step-dots">
            <div id="step-dot-1" class="step-dot step-dot-active"></div>
            <div id="step-dot-2" class="step-dot"></div>
        </div>

        <!-- STEP 1 – Physische Attribute -->
        <div id="attr-step-1" class="attr-step attr-step-active">
            <div class="attr-section">
                <div class="attr-grid">

                    <div class="attr-row">
                        <span class="attr-label">Schnelligkeit</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="speed" min="1" max="10"
                                   value="{{ player.speed }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Ausdauer</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="stamina" min="1" max="10"
                                   value="{{ player.stamina }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Koerperkraft</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="strength" min="1" max="10"
                                   value="{{ player.strength }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Aggressivitaet</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="aggression" min="1" max="10"
                                   value="{{ player.aggression }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Zweikampf</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="tackling" min="1" max="10"
                                   value="{{ player.tackling }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Groesse (cm)</span>
                        <input class="attr-input" type="number" name="height_cm" min="120" max="220"
                               value="{{ player.height_cm or '' }}">
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Gewicht (kg)</span>
                        <input class="attr-input" type="number" name="weight_kg" min="30" max="120"
                               value="{{ player.weight_kg or '' }}">
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Starker Fuss</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range-foot" type="range"
                                   name="preferred_foot_slider"
                                   min="0" max="1" step="1"
                                   value="{% if player.preferred_foot == 'Right' %}1{% else %}0{% endif %}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>L</span><span>R</span></div>
                    </div>

                </div>
            </div>

            <div style="text-align: center; margin: 8px 0 4px;">
                <button class="btn" type="button" id="btn-next-step">
                    Weiter zu Technik
                </button>
            </div>
        </div>

        <!-- STEP 2 – Technische Attribute -->
        <div id="attr-step-2" class="attr-step">

            <div class="attr-section">
                <div class="attr-grid">

                    <div class="attr-row">
                        <span class="attr-label">Ballannahme</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="first_touch" min="1" max="10"
                                   value="{{ player.first_touch }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Dribbling</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="dribbling" min="1" max="10"
                                   value="{{ player.dribbling }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Kurzpassspiel</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="short_passing" min="1" max="10"
                                   value="{{ player.short_passing }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Langpassspiel</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="long_passing" min="1" max="10"
                                   value="{{ player.long_passing }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Abschluss</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="finishing" min="1" max="10"
                                   value="{{ player.finishing }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Schusskraft</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="shooting_power" min="1" max="10"
                                   value="{{ player.shooting_power }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                    <div class="attr-row">
                        <span class="attr-label">Spielintelligenz</span>
                        <div class="slider-wrapper">
                            <input class="attr-input attr-range" type="range" name="decision_making" min="1" max="10"
                                   value="{{ player.decision_making }}">
                            <div class="attr-range-value"></div>
                        </div>
                        <div class="attr-scale"><span>1</span><span>10</span></div>
                    </div>

                </div>
            </div>

            <div style="text-align: center; margin: 10px 0 6px;">
                <button class="btn" type="submit">
                    Speichern & weiter zur Formation
                </button>
            </div>

        </div>

    </form>
</div>

<div style="text-align: center; margin-top: 4px;">
    <a href="{{ url_for('list_players') }}">
        <button class="btn" type="button">Zurueck zur Uebersicht</button>
    </a>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

    /* STEP HANDLING */
    const step1 = document.getElementById('attr-step-1');
    const step2 = document.getElementById('attr-step-2');
    const dot1 = document.getElementById('step-dot-1');
    const dot2 = document.getElementById('step-dot-2');
    const btnNext = document.getElementById('btn-next-step');
    const mainTitle = document.getElementById('attr-main-title');

    btnNext.addEventListener('click', () => {
        step1.classList.remove('attr-step-active');
        step2.classList.add('attr-step-active');
        dot1.classList.remove('step-dot-active');
        dot2.classList.add('step-dot-active');
        mainTitle.textContent = "Technische Attribute";
    });

    /* SLIDER VALUE BUBBLES */
    const wrappers = document.querySelectorAll(".slider-wrapper");

    wrappers.forEach(wrapper => {
        const slider = wrapper.querySelector("input[type=range]");
        const bubble = wrapper.querySelector(".attr-range-value");

        function updateBubble() {
            const val = parseFloat(slider.value);
            const min = parseFloat(slider.min) || 0;
            const max = parseFloat(slider.max) || 100;

            // If this is the foot selector → NO NUMBER
            if (slider.name === "preferred_foot_slider") {
                bubble.textContent = "";
            } else {
                bubble.textContent = val;
            }

            const percent = (val - min) / (max - min);  // 0..1
            bubble.style.left = (percent * 100) + "%";
        }

        slider.addEventListener("input", updateBubble);
        window.addEventListener("resize", updateBubble);
        updateBubble();
    });
});
</script>

{% endblock %}
